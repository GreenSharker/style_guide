<p id="notice"></p>

<%= form_for(@working_article, remote: true) do |f| %>

<div class="view">
  <div class="col-xs-3 col-sm-1">
    <% @working_article.page.section_pages.each do |page| %>
    <div class="col-xs-12 col-sm-12">
      <div>
        <a href="<%=  page_path(page) %>"><img width="100%" src="<%= page.jpg_image_path %>"></img>
          <p align=center><%= page.page_number %>
        </a>
      </div>
    </div>
    <% end %>
  </div>

  <div class="col-xs-9 col-sm-4">
    <div class="button-group">
      <%= raw @working_article.page.to_svg_with_jpg %>
      <p align=center>
        <%= @working_article.page.page_number %> </a>
    </div>
  </div>

  <div class="col-xs-12 col-sm-6" style="padding-bottom: 40px;" width="100%">
    <input class="input_d" id="tab1" type="radio" name="tabs" checked>
    <label class="taplabel" for="tab1">기사</label>
    <input class="input_d" id="tab2" type="radio" name="tabs">
    <label class="taplabel" for="tab2">사진</label>
    <input class="input_d" id="tab3" type="radio" name="tabs">
    <label class="taplabel" for="tab3">미리보기</label>

   <section class="section" id="content1">
      <% if @working_article.kind == '사설' || @working_article.kind == 'editorial' %>
      <%= render 'editorial', article: @working_article, page_number:  @working_article.page_number%>
      <% elsif @working_article.kind == '기고' || @working_article.kind == 'opinion' %>
      <%= render 'opinion', article: @working_article %>
      <% else %>
      <%= render 'form', article: @working_article %>
      <% end %>
    </section>

    <section class="section" id="content2">
      <% if @working_article.kind == '기사' || '사진' %>
      <div class="row">
        <% @working_article.images.each do |image| %>
          <%= render 'images/form', image: image %>
        <% end %>
      </div>
      <% if  @working_article.images.length <= 2 %>
      <%= form_with( model: @working_article, :html => { :multipart => true }, :url=> {action: 'upload_images'}) do |f| %>
      <%= f.fields_for :images, Image.new do |p| %>
      <br>
      <br>
      <hr>
      <div class="field">
        <%= p.label '사진선택' %><br>
        <p>
          <%= p.file_field :image, :multiple => true, name: "images[image][]" %>
        </p>
      </div>
      <% end %>
      <div class="actions">
        <%= f.button "사진 올리기", issue: @working_article.issue, class: "btn btn-primary btn-sm", data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> 처리중..."} %>
      </div>
      <% end %>
      <% end %>

      <% link_to "이미지 추가", add_image_article_path(@working_article), method: :get, class: "btn btn-sm btn-danger" %>
      <% link_to "저자 이미지 추가", add_personal_image_article_path(@working_article), method: :get, class: "btn btn-sm btn-danger" %>
      <br>
      <hr>
      <% end %>
      </section>

      <section class="section" id="content3">
        <img src="<%= @working_article.jpg_image_path %>">
    
        <% if @working_article.article_info && @working_article.article_info[:overflow_text] && @working_article.article_info[:overflow_text] !=""%>
        <div align="center">
          <p>본문 글자수:
            <%= @working_article.character_count %> | 박스 추가 행:
            <%= @working_article.extended_line_count %> | 발문 추가:
            <%= @working_article.quote_box_size %> | 넘친줄 수:
            <%=  @working_article.article_info[:overflow_line_count] %>
          </p>
        </div>
        <div align="center" style="color:red;">
          <%=  @working_article.article_info[:overflow_text].html_safe%>
        </div>
        <% elsif @working_article.article_info && @working_article.article_info[:empty_lines] %>
        <p align="center">본문 글자수:
          <%= @working_article.character_count %> | 박스 추가 행:
          <%= @working_article.extended_line_count %> | 발문 추가:
          <%= @working_article.quote_box_size %> | 빈줄 수:
          <%= @working_article.article_info[:empty_lines] %>
        </p>
        <% else %>
        <p align="center">본문 글자수:
          <%= @working_article.character_count %> | 박스 추가 행:
          <%= @working_article.extended_line_count %> | 발문 추가:
          <%= @working_article.quote_box_size %>
        </p>
        <% end %>
        <br>
        <br>
      </section>
  </div>


  <!-- 편집화면 상단에 자주쓰는 이전, 저장, 다운 버튼을 항상 보이게 설정 -->
  <nav class="navbar navbar-default navbar-fixed-top2">
    <ul class="nav navbar-nav2 navbar-left float-frame">
      <li class="float-unit">
        <%= link_to "이전으로", page_path(@working_article.page), method: :get, class: "btn btn-md btn-success" %>
      </li>
      <li class="float-unit">
        <%= f.button "저장하기", soaccesskey: "s", class: "btn btn-md btn-primary", remote: true, data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> 처리중..."} %>
      </li>
      <li class="float-unit">
        <%= link_to "페이지 PDF", download_pdf_page_path(@working_article.page), method: :get, class: "btn btn-md btn-warning" %>
      </li>
      <li class="float-unit">
        <%= link_to "기사 PDF", download_pdf_working_article_path(@working_article), method: :get, class: "btn btn-md btn-danger" %>
      </li>
    </ul>
  </nav>
  
  <!-- 편집화면 하단에 자주쓰는 이전, 저장, 다운 버튼을 항상 보이게 설정 -->
  <nav class="navbar navbar-default navbar-fixed-bottom">
    <ul class="nav navbar-nav2 navbar-right float-frame">
      <li class="float-unit">
        <%= link_to "이전으로", page_path(@working_article.page), method: :get, class: "btn btn-md btn-success" %>
      </li>
      <li class="float-unit">
        <%= f.button "저장하기", accesskey: "s", class: "btn btn-md btn-primary", remote: true, data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> 처리중..."} %>
      </li>
      <li class="float-unit">
        <%= link_to "페이지 PDF", download_pdf_page_path(@working_article.page), method: :get, class: "btn btn-md btn-warning" %>
      </li>
      <li class="float-unit">
        <%= link_to "기사 PDF", download_pdf_working_article_path(@working_article), method: :get, class: "btn btn-md btn-danger" %>
      </li>
    </ul>
  </nav>
  <% end %>
